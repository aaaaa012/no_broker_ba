erDiagram
  USERS ||--o{ LISTINGS : owns
  USERS ||--o{ FAVORITES : favorites
  USERS ||--o{ VISITS : requests
  USERS ||--o{ MESSAGES : sends
  USERS ||--o{ CONVERSATIONS : participates
  USERS ||--o{ RATINGS : gives
  USERS ||--o{ AGREEMENTS : signs
  USERS ||--o{ PAYMENTS : makes

  LISTINGS ||--o{ LISTING_PHOTOS : has
  LISTINGS ||--o{ VISITS : scheduled_for
  LISTINGS ||--o{ RATINGS : receives

  CONVERSATIONS ||--o{ MESSAGES : contains

  USERS {
    uuid user_id PK
    text email
    text password_hash
    text role
    timestamptz created_at
  }

  LISTINGS {
    uuid listing_id PK
    uuid owner_id FK
    text title
    text description
    text address
    int rent
    jsonb amenities
    timestamptz created_at
  }

  LISTING_PHOTOS {
    uuid photo_id PK
    uuid listing_id FK
    text url
    int sort_order
  }

  VISITS {
    uuid visit_id PK
    uuid listing_id FK
    uuid tenant_id FK
    timestamptz requested_time
    text status
    text note
  }

  CONVERSATIONS {
    uuid conversation_id PK
    jsonb participants
    timestamptz updated_at
  }

  MESSAGES {
    uuid message_id PK
    uuid conversation_id FK
    uuid sender_id FK
    text text
    boolean read
    timestamptz created_at
  }

  NOTIFICATIONS {
    uuid notification_id PK
    uuid user_id FK
    text type
    jsonb payload
    boolean read
    timestamptz created_at
  }

  FAVORITES {
    uuid user_id FK
    uuid listing_id FK
    timestamptz created_at
  }

  RATINGS {
    uuid rating_id PK
    uuid listing_id FK
    uuid user_id FK
    int score
    text comment
    timestamptz created_at
  }

  AGREEMENTS {
    uuid agreement_id PK
    uuid listing_id FK
    uuid tenant_id FK
    text terms
    text status
    timestamptz created_at
  }

  PAYMENTS {
    uuid payment_id PK
    uuid agreement_id FK
    numeric amount
    text method
    text status
    timestamptz created_at
  }

